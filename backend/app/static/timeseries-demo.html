<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VeriSafe - ì‹œê³„ì—´ AI ìœ„í—˜ë„ ì˜ˆì¸¡ ë°ëª¨</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            padding: 40px;
        }

        .control-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
        }

        .control-section h2 {
            color: #333;
            margin-bottom: 20px;
        }

        .btn {
            padding: 15px 30px;
            font-size: 1.1em;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .results {
            display: none;
        }

        .results.active {
            display: block;
        }

        .section {
            margin-bottom: 40px;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.6s ease;
        }

        .section.active {
            opacity: 1;
            transform: translateY(0);
        }

        .section h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .model-info {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .model-info h3 {
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .model-info ul {
            list-style: none;
            padding-left: 0;
        }

        .model-info li {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .model-info li:last-child {
            border-bottom: none;
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin-bottom: 30px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .prediction-display {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
        }

        .prediction-formula {
            font-size: 1.5em;
            color: #333;
            margin: 20px 0;
            font-weight: bold;
        }

        .prediction-formula .value {
            color: #667eea;
            font-size: 1.3em;
        }

        .prediction-result {
            font-size: 3em;
            color: #764ba2;
            font-weight: bold;
            margin: 20px 0;
        }

        .risk-badge {
            display: inline-block;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            margin-top: 10px;
        }

        .risk-low {
            background: #28a745;
            color: white;
        }

        .risk-medium {
            background: #ffc107;
            color: #333;
        }

        .risk-high {
            background: #dc3545;
            color: white;
        }

        .heatmap-container {
            overflow-x: auto;
            margin-bottom: 30px;
        }

        .heatmap-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .heatmap-table th,
        .heatmap-table td {
            padding: 12px;
            text-align: center;
            border: 1px solid #dee2e6;
        }

        .heatmap-table th {
            background: #667eea;
            color: white;
            font-weight: bold;
        }

        .heatmap-cell {
            transition: all 0.3s;
            cursor: pointer;
        }

        .heatmap-cell:hover {
            transform: scale(1.1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .lstm-animation {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .lstm-steps {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 30px 0;
        }

        .lstm-step {
            flex: 1;
            text-align: center;
            padding: 20px;
            opacity: 0.3;
            transition: all 0.5s;
        }

        .lstm-step.active {
            opacity: 1;
            transform: scale(1.1);
        }

        .lstm-step .step-icon {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .lstm-step .step-title {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .lstm-step .step-desc {
            font-size: 0.9em;
            color: #666;
        }

        .arrow {
            font-size: 2em;
            color: #667eea;
            opacity: 0.3;
            transition: all 0.5s;
        }

        .arrow.active {
            opacity: 1;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-card h3 {
            font-size: 2em;
            margin-bottom: 5px;
        }

        .stat-card p {
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>VeriSafe - ì‹œê³„ì—´ AI ìœ„í—˜ë„ ì˜ˆì¸¡</h1>
            <p>LSTM ë”¥ëŸ¬ë‹ ê¸°ë°˜ ì‹¤ì‹œê°„ ìœ„í—˜ë„ ì˜ˆì¸¡ ì‹œìŠ¤í…œ ë°ëª¨</p>
        </div>

        <div class="main-content">
            <div class="control-section">
                <h2>ì˜ˆì¸¡ ì‹œì‘í•˜ê¸°</h2>
                <button class="btn" onclick="runPredictionDemo()">
                    ì‹œê³„ì—´ ì˜ˆì¸¡ ì‹œì—°í•˜ê¸°
                </button>
            </div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>AIê°€ ê³¼ê±° 7ì¼ê°„ì˜ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ê³  ìœ„í—˜ë„ë¥¼ ì˜ˆì¸¡ ì¤‘ì…ë‹ˆë‹¤...</p>
            </div>

            <div class="results" id="results">
                <!-- Model Architecture Info -->
                <div class="section" data-step="0">
                    <h2>ğŸ§  AI ëª¨ë¸ êµ¬ì¡°</h2>
                    <div class="model-info">
                        <h3>Bidirectional LSTM + Attention Mechanism</h3>
                        <ul>
                            <li><strong>ëª¨ë¸ íƒ€ì…:</strong> <span id="modelType">-</span></li>
                            <li><strong>ë ˆì´ì–´:</strong> <span id="modelLayers">-</span></li>
                            <li><strong>íˆë“  ìœ ë‹›:</strong> <span id="modelHidden">-</span></li>
                            <li><strong>ì…ë ¥ ì‹œí€€ìŠ¤:</strong> <span id="modelSequence">-</span></li>
                            <li><strong>íŠ¹ì„± ìˆ˜:</strong> <span id="modelFeatures">-</span></li>
                        </ul>
                    </div>
                </div>

                <!-- Past 7 Days Chart -->
                <div class="section" data-step="1">
                    <h2>ğŸ“Š ê³¼ê±° 7ì¼ ìœ„í—˜ë„ ì¶”ì´</h2>
                    <div class="chart-container">
                        <canvas id="past7DaysChart"></canvas>
                    </div>
                </div>

                <!-- LSTM Animation -->
                <div class="section" data-step="2">
                    <h2>ğŸ”„ LSTM ì˜ˆì¸¡ ê³¼ì •</h2>
                    <div class="lstm-animation">
                        <div class="lstm-steps">
                            <div class="lstm-step" id="lstm-step-1">
                                <div class="step-icon">ğŸ“¥</div>
                                <div class="step-title">ì…ë ¥</div>
                                <div class="step-desc">7ì¼ ì‹œê³„ì—´ ë°ì´í„°</div>
                            </div>
                            <div class="arrow" id="arrow-1">â†’</div>
                            <div class="lstm-step" id="lstm-step-2">
                                <div class="step-icon">ğŸ§®</div>
                                <div class="step-title">LSTM ì²˜ë¦¬</div>
                                <div class="step-desc">ì–‘ë°©í–¥ í•™ìŠµ</div>
                            </div>
                            <div class="arrow" id="arrow-2">â†’</div>
                            <div class="lstm-step" id="lstm-step-3">
                                <div class="step-icon">ğŸ¯</div>
                                <div class="step-title">Attention</div>
                                <div class="step-desc">ì¤‘ìš”ë„ ê³„ì‚°</div>
                            </div>
                            <div class="arrow" id="arrow-3">â†’</div>
                            <div class="lstm-step" id="lstm-step-4">
                                <div class="step-icon">ğŸ“¤</div>
                                <div class="step-title">ì¶œë ¥</div>
                                <div class="step-desc">ê¸°ë³¸ ìœ„í—˜ë„</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Prediction Display -->
                <div class="section" data-step="3">
                    <h2>ğŸ¯ ìµœì¢… ì˜ˆì¸¡ ê²°ê³¼</h2>
                    <div class="prediction-display">
                        <h3>ìœ„í—˜ë„ ê³„ì‚° ê³µì‹</h3>
                        <div class="prediction-formula">
                            ê¸°ë³¸ ìœ„í—˜ë„ <span class="value" id="baseRiskValue">-</span>
                            Ã— ì‹œê°„ ìŠ¹ìˆ˜ <span class="value" id="multiplierValue">-</span>
                            = ìµœì¢… ìœ„í—˜ë„ <span class="value" id="finalRiskValue">-</span>
                        </div>
                        <div class="prediction-result" id="finalRiskScore">-</div>
                        <div class="risk-badge" id="riskBadge">-</div>
                        <p style="margin-top: 20px; color: #666;">
                            ì‹ ë¢°ë„: <strong id="confidenceValue">-</strong>% | ì˜ˆì¸¡ ë°©ë²•: <strong id="methodValue">-</strong>
                        </p>
                    </div>
                </div>

                <!-- Time Multiplier Heatmap -->
                <div class="section" data-step="4">
                    <h2>ğŸ—“ï¸ ì‹œê°„ëŒ€ë³„ ìœ„í—˜ ìŠ¹ìˆ˜ íˆíŠ¸ë§µ</h2>
                    <div class="heatmap-container">
                        <table class="heatmap-table" id="heatmapTable">
                            <!-- Will be populated by JavaScript -->
                        </table>
                    </div>
                    <p style="text-align: center; color: #666; margin-top: 15px;">
                        <strong>ìƒ‰ìƒ:</strong> ğŸŸ¢ ë‚®ìŒ (0.5-0.8) | ğŸŸ¡ ë³´í†µ (0.8-1.2) | ğŸŸ  ë†’ìŒ (1.2-1.5) | ğŸ”´ ë§¤ìš° ë†’ìŒ (1.5+)
                    </p>
                </div>

                <!-- Future 24h Chart -->
                <div class="section" data-step="5">
                    <h2>ğŸ”® í–¥í›„ 24ì‹œê°„ ì˜ˆì¸¡</h2>
                    <div class="chart-container">
                        <canvas id="future24hChart"></canvas>
                    </div>
                </div>

                <!-- Statistics -->
                <div class="section" data-step="6">
                    <h2>ğŸ“ˆ ì˜ˆì¸¡ í†µê³„</h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3 id="avgPast7Days">-</h3>
                            <p>ê³¼ê±° 7ì¼ í‰ê· </p>
                        </div>
                        <div class="stat-card">
                            <h3 id="predictedRisk">-</h3>
                            <p>í˜„ì¬ ì˜ˆì¸¡ ìœ„í—˜ë„</p>
                        </div>
                        <div class="stat-card">
                            <h3 id="peakTime">-</h3>
                            <p>ìµœê³  ìœ„í—˜ ì‹œê°„</p>
                        </div>
                        <div class="stat-card">
                            <h3 id="avgNext24h">-</h3>
                            <p>í–¥í›„ 24h í‰ê· </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = window.location.origin;
        let past7DaysChart = null;
        let future24hChart = null;

        async function runPredictionDemo() {
            showLoading();

            try {
                const response = await fetch(`${API_BASE}/api/admin/ai/timeseries-demo`);
                const data = await response.json();

                if (data.status === 'success') {
                    displayResults(data);
                } else {
                    alert('ì˜ˆì¸¡ ì‹¤íŒ¨: ' + (data.detail || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                    hideLoading();
                }
            } catch (error) {
                console.error('Error:', error);
                alert('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ' + error.message);
                hideLoading();
            }
        }

        function showLoading() {
            document.getElementById('loading').classList.add('active');
            document.getElementById('results').classList.remove('active');
        }

        function hideLoading() {
            document.getElementById('loading').classList.remove('active');
        }

        function displayResults(data) {
            setTimeout(() => {
                hideLoading();
                document.getElementById('results').classList.add('active');

                // Display model info
                displayModelInfo(data.model_info);

                // Display past 7 days chart
                displayPast7DaysChart(data.past_7_days);

                // Display prediction
                displayPrediction(data.prediction);

                // Display heatmap
                displayHeatmap(data.heatmap);

                // Display future 24h chart
                displayFuture24hChart(data.future_24h);

                // Display statistics
                displayStatistics(data);

                // Animate sections
                animateSections();

                // Animate LSTM steps
                animateLSTMSteps();
            }, 1000);
        }

        function displayModelInfo(modelInfo) {
            document.getElementById('modelType').textContent = modelInfo.architecture;
            document.getElementById('modelLayers').textContent = `${modelInfo.lstm_layers}ì¸µ`;
            document.getElementById('modelHidden').textContent = modelInfo.hidden_size;
            document.getElementById('modelSequence').textContent = `${modelInfo.sequence_length}ì¼`;
            document.getElementById('modelFeatures').textContent = `${modelInfo.num_features}ê°œ`;
        }

        function displayPast7DaysChart(past7Days) {
            const ctx = document.getElementById('past7DaysChart').getContext('2d');

            const labels = past7Days.map(d => {
                const date = new Date(d.timestamp);
                return `${date.getMonth()+1}/${date.getDate()} ${String(date.getHours()).padStart(2, '0')}:00`;
            });

            const data = past7Days.map(d => d.risk_score);
            const colors = past7Days.map(d => {
                if (d.risk_score >= 80) return 'rgba(220, 53, 69, 0.5)';
                if (d.risk_score >= 50) return 'rgba(255, 193, 7, 0.5)';
                return 'rgba(40, 167, 69, 0.5)';
            });

            if (past7DaysChart) past7DaysChart.destroy();

            past7DaysChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'ìœ„í—˜ë„',
                        data: data,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: colors,
                        pointBorderColor: colors,
                        pointRadius: 5,
                        pointHoverRadius: 7
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'ìœ„í—˜ë„ ì ìˆ˜'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'ì‹œê°„'
                            }
                        }
                    }
                }
            });
        }

        function displayPrediction(prediction) {
            document.getElementById('baseRiskValue').textContent = prediction.base_risk_score.toFixed(1);
            document.getElementById('multiplierValue').textContent = prediction.time_multiplier.toFixed(2);
            document.getElementById('finalRiskValue').textContent = prediction.final_risk_score.toFixed(1);
            document.getElementById('finalRiskScore').textContent = prediction.final_risk_score.toFixed(1);
            document.getElementById('confidenceValue').textContent = (prediction.confidence * 100).toFixed(0);
            document.getElementById('methodValue').textContent = prediction.method;

            const badge = document.getElementById('riskBadge');
            if (prediction.final_risk_score >= 80) {
                badge.textContent = 'ë§¤ìš° ë†’ìŒ';
                badge.className = 'risk-badge risk-high';
            } else if (prediction.final_risk_score >= 50) {
                badge.textContent = 'ë³´í†µ';
                badge.className = 'risk-badge risk-medium';
            } else {
                badge.textContent = 'ë‚®ìŒ';
                badge.className = 'risk-badge risk-low';
            }
        }

        function displayHeatmap(heatmap) {
            const table = document.getElementById('heatmapTable');
            const days = ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† ', 'ì¼'];

            let html = '<thead><tr><th>ì‹œê°„</th>';
            days.forEach(day => {
                html += `<th>${day}</th>`;
            });
            html += '</tr></thead><tbody>';

            for (let hour = 0; hour < 24; hour++) {
                html += `<tr><th>${String(hour).padStart(2, '0')}:00</th>`;
                for (let dow = 0; dow < 7; dow++) {
                    const key = `${dow}_${hour}`;
                    const multiplier = heatmap[key] || 1.0;
                    const color = getHeatmapColor(multiplier);
                    html += `<td class="heatmap-cell" style="background-color: ${color};" title="ìŠ¹ìˆ˜: ${multiplier.toFixed(2)}">${multiplier.toFixed(2)}</td>`;
                }
                html += '</tr>';
            }

            html += '</tbody>';
            table.innerHTML = html;
        }

        function getHeatmapColor(multiplier) {
            if (multiplier >= 1.5) return '#dc3545';  // Red
            if (multiplier >= 1.2) return '#fd7e14';  // Orange
            if (multiplier >= 0.8) return '#ffc107';  // Yellow
            return '#28a745';  // Green
        }

        function displayFuture24hChart(future24h) {
            const ctx = document.getElementById('future24hChart').getContext('2d');

            const labels = future24h.map((d, i) => `+${i+1}h`);
            const data = future24h.map(d => d.predicted_risk);
            const colors = future24h.map(d => {
                if (d.predicted_risk >= 80) return 'rgba(220, 53, 69, 0.5)';
                if (d.predicted_risk >= 50) return 'rgba(255, 193, 7, 0.5)';
                return 'rgba(40, 167, 69, 0.5)';
            });

            if (future24hChart) future24hChart.destroy();

            future24hChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'ì˜ˆì¸¡ ìœ„í—˜ë„',
                        data: data,
                        backgroundColor: colors,
                        borderColor: '#667eea',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'ìœ„í—˜ë„ ì ìˆ˜'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'í–¥í›„ ì‹œê°„'
                            }
                        }
                    }
                }
            });
        }

        function displayStatistics(data) {
            // Average past 7 days
            const avgPast = data.past_7_days.reduce((sum, d) => sum + d.risk_score, 0) / data.past_7_days.length;
            document.getElementById('avgPast7Days').textContent = avgPast.toFixed(1);

            // Current prediction
            document.getElementById('predictedRisk').textContent = data.prediction.final_risk_score.toFixed(1);

            // Peak time (find max in future 24h)
            let maxRisk = 0;
            let maxHour = 0;
            data.future_24h.forEach((d, i) => {
                if (d.predicted_risk > maxRisk) {
                    maxRisk = d.predicted_risk;
                    maxHour = i + 1;
                }
            });
            document.getElementById('peakTime').textContent = `+${maxHour}ì‹œê°„`;

            // Average next 24h
            const avgNext = data.future_24h.reduce((sum, d) => sum + d.predicted_risk, 0) / data.future_24h.length;
            document.getElementById('avgNext24h').textContent = avgNext.toFixed(1);
        }

        function animateSections() {
            const sections = document.querySelectorAll('.section');
            let delay = 0;
            sections.forEach((section, index) => {
                setTimeout(() => {
                    section.classList.add('active');
                }, delay);
                delay += 600;
            });
        }

        function animateLSTMSteps() {
            setTimeout(() => {
                let delay = 0;
                for (let i = 1; i <= 4; i++) {
                    setTimeout(() => {
                        document.getElementById(`lstm-step-${i}`).classList.add('active');
                        if (i < 4) {
                            document.getElementById(`arrow-${i}`).classList.add('active');
                        }
                    }, delay);
                    delay += 600;
                }
            }, 1800); // Start after section 2 is visible
        }
    </script>
</body>
</html>
