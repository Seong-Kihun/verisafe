# VeriSafe 웹 포털 사용 가이드

## 🎯 개요

VeriSafe 웹 포털은 매퍼와 검수자가 효율적으로 지리 정보를 관리할 수 있도록 설계된 전문가용 도구입니다.

**플랫폼 분리 전략:**
- **모바일 앱** (React Native): 일반 유저용 - 간단하고 빠른 UX
- **웹 포털** (Next.js): 매퍼/검수자용 - 정밀 작업에 최적화된 UX

## 🚀 빠른 시작

### 1. 실행 방법

#### 방법 A: 배치 파일 사용 (추천)

```bash
# 프로젝트 루트에서
START_WEB_PORTAL.bat
```

#### 방법 B: 수동 실행

```bash
cd web-portal
npm install
npm run dev
```

### 2. 접속

브라우저에서 http://localhost:3000 접속

### 3. 로그인

백엔드에서 생성한 계정으로 로그인:
- **매퍼 계정**: 지도 편집 권한
- **관리자 계정**: 지도 편집 + 검수 권한

## 📱 모바일 앱에서 접근

매퍼나 관리자 역할을 가진 사용자는 모바일 앱의 **프로필 탭**에서 "매핑 포털" 메뉴를 통해 웹 포털로 이동할 수 있습니다.

위치: `내페이지 탭 > 나의 활동 > 매핑 포털`

## 👤 사용자 역할

### 일반 유저 (user)
- ❌ 웹 포털 접근 불가
- ✅ 모바일 앱만 사용
- 검증된 지리 정보 조회, 경로 계획, 제보 등

### 매퍼 (mapper)
- ✅ 웹 포털 접근 가능
- ✅ 지도 편집 (건물, 도로 등 그리기)
- ✅ 내 기여 확인
- ❌ 검수 기능 없음

### 관리자 (admin)
- ✅ 웹 포털 모든 기능
- ✅ 지도 편집
- ✅ 검수 대기열
- ✅ 검수 대시보드
- ✅ 승인/거부 권한

## 🗺️ 매퍼 워크플로우

### 1. 지도 편집

1. **사이드바 > 지도 편집** 클릭
2. 위성 이미지 지도에서 정보를 확인
3. 우측 상단 도구 사용:
   - 📍 마커: 포인트 객체 (병원, 학교 등)
   - 📏 선: 도로, 경로 등
   - ⬛ 다각형: 건물, 지역 등
4. 객체 그리기 완료 시 자동으로 정보 입력 폼 표시
5. **객체 유형** 선택 (건물, 도로, 병원, 학교 등)
6. **이름**, **설명** 입력 (선택사항)
7. **제출** 버튼 클릭

### 2. 내 기여 확인

1. **사이드바 > 내 기여** 클릭
2. 통계 카드에서 현황 확인:
   - 총 제출
   - 검수 대기
   - 검수 중
   - 승인됨
   - 거부됨
3. 상태별 필터링하여 목록 확인
4. 검수 코멘트 확인

## ✅ 검수자 워크플로우 (관리자 전용)

### 1. 검수 대기열

1. **사이드바 > 검수 대기열** 클릭
2. 필터 선택:
   - **전체**: AI + 매퍼 제출 모두
   - **매퍼 제출**: 사람이 직접 입력한 정보
   - **AI 탐지**: AI가 자동으로 감지한 정보
3. 테이블에서 항목 확인:
   - 객체 유형
   - 이름
   - 출처
   - 신뢰도 (AI는 0.6~0.95, 매퍼는 1.0)
   - 상태 (검수 대기 / 검수 중)
4. **검수하기** 버튼 클릭

### 2. 검수 진행

1. 우측 패널에서 상세 정보 확인:
   - 객체 유형, 이름, 설명
   - 출처, 신뢰도
   - 좌표
2. **지도 확인** (향후 기능: 지도상에 표시)
3. **검수 코멘트** 입력 (선택사항, 거부 시 필수)
4. 판단:
   - **승인**: 정보가 정확함 → 공개 지도에 반영
   - **거부**: 정보가 부정확함 → 매퍼에게 피드백

### 3. 검수 대시보드

1. **사이드바 > 검수 대시보드** 클릭
2. 주요 지표 확인:
   - **검수 대기**: 아직 검토 안 된 항목
   - **검수 중**: 현재 검토 중인 항목
   - **오늘 승인**: 오늘 승인한 건수
   - **오늘 거부**: 오늘 거부한 건수
3. **출처별 대기 현황**: AI vs 매퍼
4. **작업 효율성**: 승인 비율, 처리 건수

## 🎨 UI/UX 특징

### 큰 화면에 최적화

- 넓은 지도 뷰: 위성 이미지를 자세히 확인
- 정밀한 드로잉: 마우스로 정확한 경계 그리기
- 멀티태스킹: 여러 창을 열어 비교 검토

### 직관적 인터페이스

- **사이드바**: 주요 메뉴 한눈에
- **헤더**: 현재 페이지 제목 및 안내
- **폼 패널**: 작업 중에만 나타남
- **통계 카드**: 색상으로 상태 구분

### 반응형 디자인

- 태블릿, 데스크톱 모두 지원
- 모바일은 전용 앱 사용 권장

## 🔧 기술 상세

### 지도 기술

- **Leaflet**: 오픈소스 지도 라이브러리
- **Leaflet.draw**: 드로잉 플러그인
- **위성 타일**: ArcGIS World_Imagery
- **레이블 타일**: OpenStreetMap (반투명)

### GeoJSON 형식

그린 객체는 자동으로 GeoJSON 형식으로 변환되어 백엔드로 전송됩니다:

```json
{
  "type": "Point",
  "coordinates": [127.123, 37.456]
}
```

### 인증 시스템

- **JWT 토큰**: 로그인 시 발급
- **로컬스토리지**: 토큰 저장
- **자동 리다이렉트**: 미인증 시 로그인 페이지로

## 📊 검수 기준 가이드

### 승인 기준

✅ **승인해야 하는 경우:**
- 위성 이미지에서 객체를 명확히 확인 가능
- 객체 유형이 정확함
- 경계가 정밀하게 그려짐
- 중복되지 않음

### 거부 기준

❌ **거부해야 하는 경우:**
- 위성 이미지와 일치하지 않음
- 객체 유형이 잘못됨 (예: 도로를 건물로 표시)
- 경계가 너무 부정확함
- 이미 존재하는 객체와 중복됨
- 스팸성 제출

### 거부 코멘트 작성 예시

- "위성 이미지상 건물이 확인되지 않습니다"
- "도로가 아닌 인도로 보입니다"
- "경계선이 실제 건물 범위를 벗어납니다"
- "이미 등록된 서울시청과 중복됩니다 (ID: xxx)"

## 🔄 데이터 흐름

```
매퍼가 지도에 그리기
  ↓
GeoJSON 변환
  ↓
백엔드 POST /api/mapper/features
  ↓
review_status: 'pending'으로 저장
  ↓
검수 대기열에 표시
  ↓
검수자가 검토
  ↓
승인 → verified: true, review_status: 'approved'
  ↓
공개 지도에 반영 (모바일 앱에서 보임)
```

## 🐛 문제 해결

### 지도가 로딩되지 않음

1. 브라우저 콘솔에서 에러 확인 (F12)
2. 인터넷 연결 확인 (위성 타일은 CDN에서 로드)
3. 페이지 새로고침 (Ctrl+R)

### 로그인이 안 됨

1. 백엔드가 실행 중인지 확인 (http://localhost:8000)
2. 계정 역할 확인 (user는 웹 포털 접근 불가)
3. 브라우저 콘솔에서 네트워크 에러 확인

### 제출이 실패함

1. 백엔드 로그 확인
2. GeoJSON 형식 확인 (브라우저 콘솔)
3. 중복 객체 확인 (50m 이내 동일 유형)

## 📞 지원

문제가 발생하면:
1. 브라우저 개발자 도구 (F12) 확인
2. `web-portal/` 디렉토리에서 `npm run lint` 실행
3. 백엔드 로그 확인
4. GitHub Issues에 보고

## 🎓 추가 학습 자료

- [Leaflet 공식 문서](https://leafletjs.com/)
- [Leaflet.draw GitHub](https://github.com/Leaflet/Leaflet.draw)
- [GeoJSON 형식](https://geojson.org/)
- [Next.js App Router](https://nextjs.org/docs/app)

---

**VeriSafe 팀**
